<div class="form-holder">
    <%var classNamePayment = model.workflow && model.workflow.status !== 'Done' ? 'activeItem' : 'passiveItem';%>
    <%var classNameRefund = model.paymentInfo && model.paymentInfo.total - model.paymentInfo.balance ? 'activeItem' : 'passiveItem';%>

    <form method="post" action="" class="form" id="invoiceForm">
        <fieldset>
            <% if(!isPaid || !model.approved){%>
            <span class="btn blue btnSave saveBtn">保存</span>
            <%}%>
            <div class="inner">
                <%if (!dialog) {%>
                <ul class="right _btnsBlockFixed">
                    <%if (model.approved) {%>
                    <button id="viewJournalEntries" class="btn slim" title="凭证录入">
                        <span class="icon-edit-list2"></span>
                    </button>
                    <%}%>
                    <%if(model.workflow && model.workflow.status !== 'Cancelled'){%>
                    <%if(model.workflow.status === 'New'){%>
                    <%if(model.approved){%>
                            <%if(!model.emailed){%>
                            <button class="btn slim sendEmail">
                                <span>发送邮件</span>
                            </button>
                            <%} else {%>
                            <button class="btn slim sendEmail">
                                <span>再次发送邮件</span>
                            </button>
                            <%}%>
                    <button class="btn slim cancelInvoice" title="取消发票">
                        <span>取消发票</span>
                    </button>
                    <li class="right fullfillOrderWrap">
                        <a class="btn slim fullfillOrder" href="javascript:;">
                            <span>付款</span>
                        </a>
                        <ul>
                            <li class="<%=classNamePayment%>">
                                <a class="newPayment" href="javascript:;"><span class="fontBold">创建付款</span></a>
                            </li>
                            <li class="<%=classNameRefund%>">
                                <a class="refund" href="javascript:;"><span class="fontBold">退款</span></a>
                            </li>
                        </ul>
                    </li>
                    <%} else {%>
                    <%if(isFinancial){%>
                    <button class="btn slim sendEmail">
                        <span>发送邮件</span>
                    </button>
                    <%} else {%>
                    <span>Draft</span>
                    <%}%>
                    <%}%>
                    <%} else {%>
                    <%if(model.approved){%>
                    <li class="right fullfillOrderWrap">
                        <a class="btn slim fullfillOrder" href="javascript:;">
                            <span>付款</span>
                        </a>
                        <ul>
                            <li class="<%=classNamePayment%>">
                                <a class="newPayment" href="javascript:;"><span class="fontBold">创建付款</span></a>
                            </li>
                            <li class="<%=classNameRefund%>">
                                <a class="refund" href="javascript:;"><span class="fontBold">退款</span></a>
                            </li>
                        </ul>
                    </li>
                    <%} else {%>
                    <%if(isFinancial){%>
                    <button class="btn slim sendEmail">
                        <span>发送邮件</span>
                    </button>
                    <%} else {%>
                    <span>Draft</span>
                    <%}%>
                    <%}%>
                    <%}%>
                    <%} else {%>
                    <button class="btn slim borderRed setDraft">
                        <span>Set Draft</span>
                    </button>
                    <%}%>
                </ul>
                <%}%>

                <div class="clearfix"></div>
                <div class="dialog-tabs-items mainTabs">
                    <div class="dialog-tabs-item mainTabs active">
                        <%if (dialog){%>
                        <%if(model.workflow.status !== 'Done'){%>
                        <%if(model.approved){%>
                        <%if(!model.emailed){%>
                        <button class="btn slim sendEmail">
                            <span>发送邮件</span>
                        </button>
                        <%} else {%>
                        <button class="btn slim sendEmail">
                            <span>再次发送邮件</span>
                        </button>
                        <%}%>

                        <%if(isFinancial){%>
                        <li class="right fullfillOrderWrap">
                            <a class="btn slim fullfillOrder" href="javascript:;">
                                <span>付款</span>
                            </a>
                            <ul>
                                <li class="<%=classNamePayment%>">
                                    <a class="newPayment" href="javascript:;"><span class="fontBold">创建付款</span></a>
                                </li>
                                <li class="<%=classNameRefund%>">
                                    <a class="refund" href="javascript:;"><span class="fontBold">退款</span></a>
                                </li>
                            </ul>
                        </li>
                        <%}%>
                        <%} else {%>
                        <button class="btn slim approve" title="Approve">
                            <span>批准</span>
                        </button>
                        <%}%>
                        <%}%>
                        <%}%>

                        <%if(!isPaid || paidAndNotApproved){%>
                        <div class="half-block left">
                            <dl class="opp-info">

                                <dt><label for="supplier"><%=(forSales) ? '客户' : '供应商'%></label></dt>
                                <dd>
                                    <span id="supplier" data-id="<%=model.supplier ? model.supplier._id : ''%>">
                                        <%=(model.supplier && model.supplier.name) ? model.supplier.name.first + ' ' + model.supplier.name.last : ""%>
                                    </span>
                                </dd>
                                <dt><label for="source_document">订单号</label></dt>
                                <dd>
                                    <%var reference = '#easyErp/order/tform/' + model.sourceDocument._id;%>
                                    <span type="text" id="source_document">#<a href="<%=reference%>"><%=(model.sourceDocument) ? model.sourceDocument.name : ''%></a></span>
                                </dd>

                                <dt><label for="supplier_invoice_num">发票号</label></dt>
                                <dd>
                                    <input type="text" id="supplier_invoice_num" class="_inputBordered"
                                           value="<%=(model.name) ? model.name : ''%>"
                                           placeholder="Supplier Invoice Number" maxlength="32"/>
                                </dd>
                                <dt><label for="journal">凭证</label></dt>
                                <dd class="_newSelectListWrap">
                                    <%if (!model.approved) {%>
                                    <a id="journal" class="current-selected"
                                       href="javascript:;"
                                       data-id="<%= model.journal && model.journal._id ? model.journal._id : ''%>"><%=
                                        model.journal && model.journal._id ? model.journal.name : '选择'%></a>
                                    <%} else {%>
                                    <span id="journal"><%= model.journal && model.journal._id ? model.journal.name : '选择'%></span>
                                    <%}%>

                                </dd>
                                <dt><label for="paymentMethod">银行账户</label></dt>
                                <dd class="">
                                    <%if (!model.approved) {%>
                                    <a id="paymentMethod" class="current-selected"
                                       href="javascript:;"  data-id="<%=model.paymentMethod && model.paymentMethod._id ? model.paymentMethod._id : null%>"><%=model.paymentMethod && model.paymentMethod._id ?model.paymentMethod.name : '选择'%></a>
                                    <%} else {%>
                                    <span id="paymentMethod" data-id="<%=model.paymentMethod && model.paymentMethod._id ? model.paymentMethod._id : null%>"><%=model.paymentMethod && model.paymentMethod._id ? model.paymentMethod.name : '无'%></span>
                                    <%}%>
                                </dd>
                            </dl>
                        </div>
                        <div class="clearfix"></div>
                        <div class="inline-row  left">
                            <dl class="opp-info">
                                <div class="left">
                                    <dt><label for="invoice_date">发票日期 </label></dt>
                                    <dd>
                                        <input type="text" class="date _inputBordered" id="invoice_date"
                                               value="<%=(model.invoiceDate) ? moment(model.invoiceDate).format('YYYY-MM-DD') : ''%>" maxlength="32"
                                               placeholder="发票日期" readonly/>
                                    </dd>
                                </div>
                                <div class="left">
                                    <dt><label for="paymentTerm">支付条款</label></dt>
                                    <dd class="_newSelectListWrap">
                                        <%if (!model.approved) {%>
                                        <a id="paymentTerm" class="current-selected" href="javascript:;">
                                            <% if (model.paymentTerms) { %>
                                            <%=model.paymentTerms.name || '选择'%>
                                            <% } else { %>
                                            <%=model.paymentTerms || '选择'%>
                                            <% } %>
                                        </a>
                                        <%} else {%>
                                        <span id="paymentTerm">
                                            <% if (model.paymentTerms) { %>
                                            <%=model.paymentTerms.name || '选择'%>
                                            <% } else { %>
                                            <%=model.paymentTerms || '选择'%>
                                            <% } %>
                                        </span>
                                        <%}%>


                                    </dd>
                                </div>
                                <div class="left">
                                    <dt><label for="due_date">到期日 </label></dt>
                                    <dd>
                                        <input type="text" class="date _inputBordered
                                <% if (!model.dueDate) {%>
                                errorContent"
                                        <% } else { %>
                                        "
                                        <% } %>
                                        id="due_date" value="<%=(model.dueDate) ? moment(model.dueDate).format('YYYY-MM-DD') : ''%>" maxlength="32"
                                        placeholder="到期日" readonly />
                                    </dd>
                                </div>
                                <div class="left">
                                    <dt><label for="currencyDd">货币</label></dt>
                                    <dd>
                                        <span id="currencyDd"
                                              data-id="<%= model.currency && model.currency._id ? model.currency._id._id : null%>">
                                            <%= model.currency && model.currency._id ? model.currency._id.name : ''%>
                                        </span>
                                    </dd>
                                </div>
                            </dl>
                        </div>
                        <%} else {%>
                        <div class="half-block left">
                            <dl class="opp-info">

                                <dt><label for="supplier"><%=(forSales) ? '客户' : '供应商'%></label></dt>
                                <dd>
                                    <span id="supplier" data-id="<%=(model.supplier)?model.supplier._id:''%>"
                                          href="javascript:;"><%=(model.supplier && model.supplier.name)?model.supplier.name.first + ' ' + model.supplier.name.last:""%></span>
                                </dd>

                                <dt><label for="source_document">订单号</label></dt>
                                <dd>
                                    <%var reference = '#easyErp/order/tform/' + model.sourceDocument._id;%>
                                    <span type="text" id="source_document">#<a href="<%=reference%>"><%=(model.sourceDocument) ? model.sourceDocument.name : ''%></a></span>
                                </dd>

                                <dt><label for="supplier_invoice_num">发票号</label></dt>
                                <dd>
                                    <span type="text"
                                          id="supplier_invoice_num"><%=(model.name) ? model.name : ''%></span>
                                </dd>


                                <dt><label for="paymentMethod">银行账户</label></dt>
                                <dd class="">
                                    <%if (!model.approved) {%>
                                    <a id="paymentMethod" class="current-selected"
                                       href="javascript:;"  data-id="<%=model.paymentMethod && model.paymentMethod._id ? model.paymentMethod._id : null%>"><%=model.paymentMethod && model.paymentMethod._id ?model.paymentMethod.name : '选择'%></a>
                                    <%} else {%>
                                    <span id="paymentMethod" data-id="<%=model.paymentMethod && model.paymentMethod._id ? model.paymentMethod._id : null%>"><%=model.paymentMethod && model.paymentMethod._id ? model.paymentMethod.name : '无'%></span>
                                    <%}%>
                                </dd>
                            </dl>
                        </div>
                        <div class="clearfix"></div>
                        <div class="inline-row  left">
                            <dl class="opp-info">
                                <div class="left">
                                    <dt><label for="inv_date">发票日期 </label></dt>
                                    <dd>
                                        <span id="inv_date"><%=(model.invoiceDate) ? moment(model.invoiceDate).format('YYYY-MM-DD') : ''%></span>
                                    </dd>
                                </div>
                                <div class="left">
                                    <dt><label for="paymentTerm">支付条款</label></dt>
                                    <dd>
                                    <span id="paymentTerm" href="javascript:;"><% if (model.paymentTerms) { %>
                                        <%=model.paymentTerms.name || '选择'%>
                                        <% } else { %>
                                         Custom
                                        <% } %>
                                    </span>
                                    </dd>
                                </div>
                                <div class="left">
                                    <dt><label for="d_date">到期日 </label></dt>
                                    <dd>
                                        <span id="d_date"><%=(model.dueDate) ? moment(model.dueDate).format('YYYY-MM-DD') : ''%></span>
                                    </dd>
                                </div>

                                <div class="left">
                                    <dt><label for="currencyDd">货币</label></dt>
                                    <dd>
                                        <span id="currencyDd"
                                              data-id="<%= model.currency && model.currency._id ? model.currency._id : null%>">
                                            <%= model.currency && model.currency._id ? model.currency._id.name : ''%>
                                        </span>
                                    </dd>

                                </div>
                            </dl>
                        </div>
                        <%}%>

                        <div class="clearfix"></div>
                        <div class="clearfix"></div>
                        <div class="dialog-tabs-item childTabs active">
                            <%if(!isWtrack) {%>
                            <div id="invoiceItemsHolder">

                            </div>
                            <div class="clearfix"></div>
                            <%} %>
                        </div>

                        <div class="dialog-tabs-item childTabs">

                        </div>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
        </fieldset>
    </form>
</div>
